# Exposure & Viewers Deduplication Algorithm

## 📌 Overview
광고 분석 지표에서 핵심이 되는 **노출 인구, 시청 인구**가 이벤트 단위로 중복 집계되어  
실제보다 과대하게 표시되는 문제가 있었습니다.  
이를 해결하기 위해 **인구 기준 Deduplication 알고리즘**을 설계·적용했습니다.

## 🔍 Problem
- 동일한 사람이 같은 광고를 여러 번 본 경우, 로그는 이벤트 단위로 여러 건 생성
- 기존 집계 로직은 이벤트 수를 그대로 합산해 인구 수로 간주
- 그 결과, 보고서 상 노출/시청 인구가 실제보다 크게 부풀려짐

## 🧮 Core Idea
> "한 사람은 하나의 광고에 대해 특정 기간 동안 최대 1명으로만 센다."

- 집계 단위를 **event → unique person** 으로 변경
- 시청 조건(예: 1초 이상 시청)을 만족하는지 여부에 따라 유효 시청 인구를 판단

## 🛠 Implementation Outline

1. 광고·날짜 범위로 raw_observation_data 조회
2. `person_id` 기준으로 그룹핑
3. 각 person에 대해:
   - 해당 광고를 본 이벤트가 1건 이상 있으면 **노출 인구 1명**
   - 시청 조건(예: 1초 이상 시청)을 만족하는 이벤트가 있으면 **시청 인구 1명**
4. 모든 person에 대해 합산하여 노출/시청 인구 산출

## 📊 Example (실제 수치)

- 노출: 12,660 → 10,737명  
- 시청: 3,907 → 3,445명  

위와 같이 **실제 인구 기준으로 다시 계산했을 때 10–15% 수준의 과대 집계가 제거**되는 것을 확인했습니다.

## 📈 Effect
- 광고 집행 결과에 대한 **지표 신뢰도** 향상
- 이후 GPS 히트맵, 대시보드, 리포트 등 모든 분석 결과의 기반 품질 향상
- 마케팅/세일즈 팀과의 커뮤니케이션에서 수치에 대한 신뢰 확보
